<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ã‹ã‚“ã—ã‚ƒã«ã£ã">
    <meta name="theme-color" content="#fff7ed">

    <title>ã‹ã‚“ã—ã‚ƒã«ã£ãğŸ˜Š</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            background-color: #fff7ed;
        }

        input, textarea {
            -webkit-user-select: text !important;
            user-select: text !important;
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.3s ease-out forwards;
        }
        
        .pressing {
            transform: scale(0.98);
            background-color: #ffe4e6;
            transition: all 0.2s;
        }

        @keyframes slide-in-right {
            from { transform: translateX(30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slide-in-left {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .animate-slide-in-right {
            animation: slide-in-right 0.3s ease-out forwards;
        }
        .animate-slide-in-left {
            animation: slide-in-left 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // --- Icon Components ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const ChevronLeft = (props) => <IconBase {...props}><path d="m15 18-6-6 6-6"/></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>;
        const BookHeart = (props) => <IconBase {...props}><path d="M16 6l-1.9 2-2.1-2a2.8 2.8 0 1 0-4 4l6 6.3 6-6.3a2.8 2.8 0 0 0-4-4z"/><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></IconBase>;
        const ArrowLeft = (props) => <IconBase {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const Settings = (props) => <IconBase {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const Download = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></IconBase>;
        const Upload = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const Camera = (props) => <IconBase {...props}><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>;
        const ZoomIn = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></IconBase>;
        const ImagePlus = (props) => <IconBase {...props}><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7"/><line x1="16" x2="22" y1="5" y2="5"/><line x1="19" x2="19" y1="2" y2="8"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></IconBase>;
        const ImageIcon = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></IconBase>;

        // ç”»åƒåœ§ç¸®ãƒ˜ãƒ«ãƒ‘ãƒ¼
        const compressImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_SIZE = 600; 
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_SIZE) {
                                height *= MAX_SIZE / width;
                                width = MAX_SIZE;
                            }
                        } else {
                            if (height > MAX_SIZE) {
                                width *= MAX_SIZE / height;
                                height = MAX_SIZE;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                    img.onerror = (err) => reject(err);
                };
                reader.onerror = (err) => reject(err);
            });
        };

        // èƒŒæ™¯ç”»åƒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ1æšå¤§ããè¡¨ç¤ºï¼‰
        const BackgroundWallpaper = ({ image }) => {
            if (!image) return null;

            return (
                <div className="fixed inset-0 pointer-events-none z-0">
                    <img 
                        src={image} 
                        className="w-full h-full object-cover opacity-60" 
                        alt="Background" 
                    />
                </div>
            );
        };

        const App = () => {
          const [screen, setScreen] = useState('title');
          
          // ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿
          const [gratitudeData, setGratitudeData] = useState(() => {
            try {
              const saved = localStorage.getItem('gratitudeData');
              return saved ? JSON.parse(saved) : {};
            } catch (e) {
              console.error("Data load error", e);
              return {};
            }
          });

          // è¨­å®šãƒ‡ãƒ¼ã‚¿ (èƒŒæ™¯ç”»åƒãªã©)
          const [settings, setSettings] = useState(() => {
              try {
                  const saved = localStorage.getItem('appSettings');
                  return saved ? JSON.parse(saved) : { backgroundImage: null };
              } catch (e) {
                  return { backgroundImage: null };
              }
          });

          const [selectedDate, setSelectedDate] = useState(new Date());
          const [currentMonth, setCurrentMonth] = useState(new Date());

          useEffect(() => {
            try {
                localStorage.setItem('gratitudeData', JSON.stringify(gratitudeData));
            } catch (e) {
                alert("å®¹é‡ãŒã„ã£ã±ã„ã§ä¿å­˜ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚å¤ã„å†™çœŸã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚");
            }
          }, [gratitudeData]);

          useEffect(() => {
              localStorage.setItem('appSettings', JSON.stringify(settings));
          }, [settings]);

          const updateData = (newData) => {
             setGratitudeData(newData);
          };

          const formatDate = (date) => {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
          };

          const goToCalendar = () => setScreen('calendar');
          const goToInput = (date) => {
            setSelectedDate(date);
            setScreen('input');
          };
          const goToTitle = () => setScreen('title');
          const goToSettings = () => setScreen('settings');

          // èƒŒæ™¯ãŒã‚ã‚‹ã¨ãã¯ã€ãƒ¡ã‚¤ãƒ³ã®èƒŒæ™¯ã‚’é€æ˜åº¦é«˜ã‚ã«ã™ã‚‹
          const mainBgClass = settings.backgroundImage ? 'bg-white/60' : 'bg-white';

          return (
            <div className="min-h-screen bg-orange-50 font-sans text-gray-800 flex justify-center relative">
              
              {/* èƒŒæ™¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */}
              <BackgroundWallpaper image={settings.backgroundImage} />

              <div className={`w-full max-w-md min-h-screen shadow-xl relative flex flex-col z-10 backdrop-blur-sm transition-colors duration-500 ${mainBgClass}`}>
                
                {screen === 'title' && (
                  <TitleScreen onStart={goToCalendar} />
                )}

                {screen === 'calendar' && (
                  <CalendarScreen 
                    currentMonth={currentMonth}
                    setCurrentMonth={setCurrentMonth}
                    gratitudeData={gratitudeData}
                    onSelectDate={goToInput}
                    onBack={goToTitle}
                    onSettings={goToSettings}
                    hasBackground={!!settings.backgroundImage}
                  />
                )}

                {screen === 'input' && (
                  <InputScreen 
                    date={selectedDate}
                    gratitudeData={gratitudeData}
                    setGratitudeData={updateData} 
                    formatDate={formatDate}
                    onBack={goToCalendar}
                    hasBackground={!!settings.backgroundImage}
                  />
                )}

                {screen === 'settings' && (
                  <SettingsScreen 
                    gratitudeData={gratitudeData}
                    setGratitudeData={updateData}
                    settings={settings}
                    setSettings={setSettings}
                    onBack={goToCalendar}
                  />
                )}

              </div>
            </div>
          );
        };

        const TitleScreen = ({ onStart }) => {
          return (
            <div className="flex-1 flex flex-col items-center justify-center p-8 bg-transparent text-center">
              <div className="mb-8 animate-bounce">
                <BookHeart size={80} className="text-pink-500 mx-auto drop-shadow-lg" />
              </div>
              <h1 className="text-4xl font-bold text-orange-600 mb-2 tracking-widest drop-shadow-sm">ã‹ã‚“ã—ã‚ƒã«ã£ãğŸ˜Š</h1>
              <p className="text-gray-500 mb-12 font-bold drop-shadow-sm">1æ—¥30å€‹ã€å¹¸ã›ã‚’è¦‹ã¤ã‘ã‚ˆã†</p>
              
              <button 
                onClick={onStart}
                className="bg-orange-400 hover:bg-orange-500 text-white font-bold py-4 px-8 rounded-full shadow-lg transform transition active:scale-95 text-xl flex items-center gap-2"
              >
                <span className="text-2xl">âœï¸</span> æ„Ÿè¬ã®è¨€è‘‰ã‚’æ›¸ã
              </button>
            </div>
          );
        };

        const CalendarScreen = ({ currentMonth, setCurrentMonth, gratitudeData, onSelectDate, onBack, onSettings, hasBackground }) => {
          const year = currentMonth.getFullYear();
          const month = currentMonth.getMonth();
          const today = new Date();

          const [slideDirection, setSlideDirection] = useState(null);
          const [touchStart, setTouchStart] = useState(null);
          const [touchEnd, setTouchEnd] = useState(null);
          const minSwipeDistance = 50;

          const onTouchStart = (e) => {
            setTouchEnd(null);
            setTouchStart(e.targetTouches[0].clientX);
          };
          const onTouchMove = (e) => setTouchEnd(e.targetTouches[0].clientX);
          const onTouchEnd = () => {
            if (!touchStart || !touchEnd) return;
            const distance = touchStart - touchEnd;
            if (distance > minSwipeDistance) nextMonth();
            if (distance < -minSwipeDistance) prevMonth();
          };

          const prevMonth = () => {
              setSlideDirection('right'); 
              setCurrentMonth(new Date(year, month - 1, 1));
          };
          const nextMonth = () => {
              setSlideDirection('left'); 
              setCurrentMonth(new Date(year, month + 1, 1));
          };

          const days = [];
          const firstDay = new Date(year, month, 1);
          const lastDay = new Date(year, month + 1, 0);
          for (let i = 0; i < firstDay.getDay(); i++) days.push(null);
          for (let i = 1; i <= lastDay.getDate(); i++) days.push(new Date(year, month, i));

          const weekDays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

          const getDayStyle = (count, isToday) => {
            let classes = "h-14 w-full flex flex-col items-center justify-center rounded-lg text-sm font-bold transition relative cursor-pointer border ";
            
            // èƒŒæ™¯ãŒã‚ã‚‹ã¨ãã¯ã€ã‚»ãƒ«ã®èƒŒæ™¯ã‚’å°‘ã—æ¿ƒãã—ã¦è¦–èªæ€§ã‚’ä¸Šã’ã‚‹
            const bgOpacity = hasBackground ? '95' : '100';
            
            if (count === 0) classes += `text-gray-400 hover:bg-gray-50/${bgOpacity} bg-white/${hasBackground ? '40' : '0'} `;
            else if (count <= 10) classes += `bg-gray-50/${bgOpacity} text-gray-500 `; 
            else if (count <= 20) classes += `bg-red-50/${bgOpacity} text-red-500 `; 
            else if (count <= 29) classes += `bg-yellow-50/${bgOpacity} text-yellow-600 `; 
            else if (count === 30) classes += "bg-blue-500 text-white shadow-md transform scale-105 z-10 ";
            else if (count <= 99) classes += "bg-yellow-300 text-blue-600 ";
            else if (count >= 100) classes += "bg-green-600 text-yellow-300 shadow-lg animate-pulse ";
            
            if (isToday) classes += "border-2 border-blue-500 z-20";
            else {
              if (count === 0) classes += "border-gray-100";
              else if (count <= 10) classes += "border-gray-200";
              else if (count <= 20) classes += "border-red-100";
              else if (count <= 29) classes += "border-yellow-100";
              else if (count === 30) classes += "border-yellow-400";
              else if (count <= 99) classes += "border-yellow-400";
              else if (count >= 100) classes += "border-2 border-red-500";
            }
            return classes;
          };

          const formatDateKey = (date) => {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
          };

          return (
            <div 
              className="flex-1 flex flex-col bg-transparent"
              onTouchStart={onTouchStart}
              onTouchMove={onTouchMove}
              onTouchEnd={onTouchEnd}
            >
              <header className="bg-orange-400 text-white p-4 flex justify-between items-center shadow-md select-none relative z-10">
                <button onClick={onBack} className="p-1 hover:bg-orange-500 rounded"><ArrowLeft /></button>
                <h2 className="text-xl font-bold">{year}å¹´ {month + 1}æœˆ</h2>
                <button onClick={onSettings} className="p-1 hover:bg-orange-500 rounded"><Settings /></button>
              </header>

              <div className="h-6"></div>

              <div className="grid grid-cols-7 gap-1 px-2 mb-2 text-center text-xs font-bold text-gray-500 select-none">
                {weekDays.map((d, i) => (
                  <div key={i} className={i === 0 ? "text-red-400 font-bold" : i === 6 ? "text-blue-400 font-bold" : "font-bold"}>{d}</div>
                ))}
              </div>

              <div 
                  key={currentMonth.toISOString()}
                  className={`grid grid-cols-7 gap-2 px-2 pb-8 ${slideDirection === 'left' ? 'animate-slide-in-right' : slideDirection === 'right' ? 'animate-slide-in-left' : ''}`}
              >
                {days.map((date, idx) => {
                  if (!date) return <div key={idx} className="h-14"></div>;
                  
                  const dateKey = formatDateKey(date);
                  const entries = gratitudeData[dateKey] || [];
                  const count = entries.length;
                  const isToday = date.getDate() === today.getDate() && 
                                  date.getMonth() === today.getMonth() && 
                                  date.getFullYear() === today.getFullYear();
                  
                  return (
                    <div 
                      key={idx} 
                      className={getDayStyle(count, isToday)}
                      onClick={() => onSelectDate(date)}
                    >
                      <span className="absolute top-1 left-1 text-[10px] opacity-70">{date.getDate()}</span>
                      {count > 0 && <span className="text-lg mt-1">{count}</span>}
                    </div>
                  );
                })}
              </div>
            </div>
          );
        };

        const InputScreen = ({ date, gratitudeData, setGratitudeData, formatDate, onBack, hasBackground }) => {
          const dateKey = formatDate(date);
          const currentEntries = gratitudeData[dateKey] || [];
          const [inputText, setInputText] = useState('');
          const scrollRef = useRef(null);
          
          const [attachedImage, setAttachedImage] = useState(null);
          const [targetIndexForImage, setTargetIndexForImage] = useState(null);
          const fileInputRef = useRef(null);

          const [deleteTarget, setDeleteTarget] = useState(null); 
          const [pressingIndex, setPressingIndex] = useState(null);
          const pressTimer = useRef(null);

          const [zoomedImage, setZoomedImage] = useState(null);
          const [particles, setParticles] = useState([]);
          const animationFrameRef = useRef();

          const updateParticles = useCallback(() => {
            setParticles(prevParticles => {
              if (prevParticles.length === 0) return [];
              return prevParticles
                .map(p => {
                  // ã‚¹ãƒšã‚·ãƒ£ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŒ™å‹•åˆ¶å¾¡
                  if (p.isSpecial) {
                      let nextP = { ...p };
                      
                      if (p.phase === 'popup') {
                          // ç›®æ¨™ä½ç½®ã«å‘ã‹ã£ã¦ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°ï¼ˆLerpï¼‰
                          nextP.x += (nextP.targetX - nextP.x) * 0.1;
                          nextP.y += (nextP.targetY - nextP.y) * 0.1;
                          
                          // ç›®æ¨™ã«è¿‘ã¥ã„ãŸã‚‰ãƒ›ãƒ¼ãƒ«ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã¸
                          if (Math.abs(nextP.targetY - nextP.y) < 2) {
                              nextP.phase = 'hold';
                          }
                      } else if (p.phase === 'hold') {
                          nextP.holdTimer -= 1;
                          // ã·ã‚‹ã·ã‚‹ã•ã›ã‚‹
                          nextP.scale = 1 + Math.sin(Date.now() / 100) * 0.1; 
                          
                          if (nextP.holdTimer <= 0) {
                              nextP.phase = 'fall';
                              // æ•£ã‚‹ãŸã‚ã®åˆé€Ÿ
                              nextP.vx = (Math.random() - 0.5) * 10;
                              nextP.vy = -5; 
                          }
                      } else {
                          // è½ä¸‹
                          nextP.x += nextP.vx;
                          nextP.y += nextP.vy;
                          nextP.vy += 0.8; 
                          nextP.rotation += nextP.vr;
                          nextP.life -= 1;
                          nextP.opacity = nextP.life < 20 ? nextP.life / 20 : 1;
                      }
                      return nextP;
                  } else {
                      // é€šå¸¸ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
                      return {
                        ...p,
                        x: p.x + p.vx,
                        y: p.y + p.vy,
                        vy: p.vy + 0.8,
                        vx: p.vx * 0.98,
                        life: p.life - 1,
                        rotation: p.rotation + p.vr,
                        opacity: p.life < 20 ? p.life / 20 : 1
                      };
                  }
                })
                .filter(p => p.life > 0);
            });
            animationFrameRef.current = requestAnimationFrame(updateParticles);
          }, []);

          useEffect(() => {
            if (particles.length > 0) {
              animationFrameRef.current = requestAnimationFrame(updateParticles);
            }
            return () => cancelAnimationFrame(animationFrameRef.current);
          }, [particles.length, updateParticles]);

          // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç™ºç«
          const triggerExplosion = (startX, startY, count) => {
            const newParticles = [];
            const chars = ['â˜†', 'â˜…', 'æ„Ÿè¬', 'âœ¨', 'ğŸ˜Š', 'ğŸ‰', 'â¤ï¸'];
            const colors = ['#FFD700', '#FFA500', '#FF69B4', '#00BFFF', '#32CD32', '#FF4500'];

            // åŸºæœ¬ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
            for (let i = 0; i < 40; i++) {
              const angle = Math.random() * Math.PI * 2;
              const speed = Math.random() * 15 + 5;
              const size = Math.random() * 20 + 10;
              newParticles.push({
                id: Math.random(),
                x: startX,
                y: startY,
                vx: Math.cos(angle) * speed * (Math.random() + 0.5),
                vy: Math.sin(angle) * speed * (Math.random() + 0.5) - 10,
                vr: (Math.random() - 0.5) * 30,
                life: 60 + Math.random() * 40,
                char: chars[Math.floor(Math.random() * chars.length)],
                color: colors[Math.floor(Math.random() * colors.length)],
                rotation: Math.random() * 360,
                scale: 0.5 + Math.random() * 1.5,
                fontSize: size,
                opacity: 1
              });
            }

            // ã‚¹ãƒšã‚·ãƒ£ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿½åŠ åˆ¤å®š
            // 30å›ç›®ï¼ˆç›®æ¨™é”æˆï¼ï¼‰
            if (count === 30) {
                newParticles.push({
                    id: Math.random(),
                    x: startX, 
                    y: startY,
                    targetX: window.innerWidth / 2, // ç”»é¢ä¸­å¤®ã¸
                    targetY: window.innerHeight / 3, // å°‘ã—ä¸Šã®æ–¹ãŒè¦‹ã‚„ã™ã„
                    vx: 0, vy: 0, vr: 0,
                    life: 200, 
                    holdTimer: 120, // 2ç§’ã‚­ãƒ¼ãƒ—
                    phase: 'popup',
                    isSpecial: true,
                    char: 'ãŠã‚ã§ã¨ã†ï¼30å›ç›®é”æˆï¼ï¼',
                    color: '#FF0000', // èµ¤è‰²ã§å¼·èª¿
                    rotation: 0,
                    scale: 1,
                    fontSize: 28, 
                    opacity: 1
                });
                
                // ç´™å¹é›ªè¿½åŠ 
                for(let i=0; i<30; i++) {
                     const angle = Math.random() * Math.PI * 2;
                     const speed = Math.random() * 20 + 5;
                     newParticles.push({
                        id: Math.random(),
                        x: window.innerWidth / 2,
                        y: window.innerHeight / 3,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed - 5,
                        vr: (Math.random() - 0.5) * 50,
                        life: 120 + Math.random() * 50,
                        char: 'ğŸ‰',
                        color: colors[Math.floor(Math.random() * colors.length)],
                        rotation: Math.random() * 360,
                        scale: 1.5,
                        fontSize: 24,
                        opacity: 1
                     });
                }
            } 
            // 10å›ç›®, 20å›ç›®... (30ä»¥å¤–ã§10ã®å€æ•°)
            else if (count % 10 === 0) {
                newParticles.push({
                    id: Math.random(),
                    x: startX,
                    y: startY,
                    targetX: window.innerWidth / 2,
                    targetY: window.innerHeight / 2, // ç”»é¢ä¸­å¤®
                    vx: 0, vy: 0, vr: 0,
                    life: 150,
                    holdTimer: 90, // 1.5ç§’ã‚­ãƒ¼ãƒ—
                    phase: 'popup',
                    isSpecial: true,
                    char: `${count}å›ç›®ï¼`,
                    color: '#FF8C00', // ãƒ€ãƒ¼ã‚¯ã‚ªãƒ¬ãƒ³ã‚¸
                    rotation: 0,
                    scale: 1,
                    fontSize: 32,
                    opacity: 1
                });
            }

            setParticles(prev => [...prev, ...newParticles]);
          };

          const getCurrentTime = () => {
            const now = new Date();
            return `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
          };

          const handleImageSelect = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            try {
                const resizedDataUrl = await compressImage(file);
                
                if (targetIndexForImage !== null) {
                    const newEntries = [...currentEntries];
                    const oldEntry = newEntries[targetIndexForImage];
                    const entryObj = typeof oldEntry === 'string' 
                        ? { text: oldEntry, time: getCurrentTime() } 
                        : { ...oldEntry };
                    
                    entryObj.image = resizedDataUrl;
                    newEntries[targetIndexForImage] = entryObj;
                    
                    setGratitudeData({
                        ...gratitudeData,
                        [dateKey]: newEntries
                    });
                    setTargetIndexForImage(null);
                } else {
                    setAttachedImage(resizedDataUrl);
                }
            } catch (err) {
                console.error("Image processing error", err);
                alert("ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ");
            }
            e.target.value = '';
          };

          const handleAdd = (e) => {
            e.preventDefault();
            if (!inputText.trim() && !attachedImage) return;
            if (currentEntries.length >= 100) {
                alert("ã™ã”ã„ï¼100å€‹é”æˆã§ã™ï¼");
                return;
            }

            let startX = window.innerWidth / 2;
            let startY = window.innerHeight - 80;
            if (e.nativeEvent && (e.nativeEvent.clientX || (e.nativeEvent.touches && e.nativeEvent.touches[0]))) {
                 const clientX = e.nativeEvent.clientX || e.nativeEvent.touches[0].clientX;
                 const clientY = e.nativeEvent.clientY || e.nativeEvent.touches[0].clientY;
                 startX = clientX;
                 startY = clientY;
            }
            
            // ä»Šå›ã®æŠ•ç¨¿æ•°ï¼ˆç¾åœ¨ã®æ•° + 1ï¼‰
            const nextCount = currentEntries.length + 1;
            triggerExplosion(startX, startY, nextCount);

            const newEntry = { 
                text: inputText, 
                time: getCurrentTime(),
                image: attachedImage 
            };
            const newEntries = [...currentEntries, newEntry];
            
            setGratitudeData({
              ...gratitudeData,
              [dateKey]: newEntries
            });

            setInputText('');
            setAttachedImage(null);
            setTimeout(() => { scrollRef.current?.scrollIntoView({ behavior: 'smooth' }); }, 100);
          };
          
          const startPress = (index, entry) => {
             setPressingIndex(index);
             pressTimer.current = setTimeout(() => {
                 setDeleteTarget({ index, text: typeof entry === 'string' ? entry : entry.text });
                 setPressingIndex(null);
             }, 600);
          };
          
          const cancelPress = () => {
              if (pressTimer.current) {
                  clearTimeout(pressTimer.current);
                  pressTimer.current = null;
              }
              setPressingIndex(null);
          };

          const executeDelete = () => {
              if (!deleteTarget) return;
              const newEntries = currentEntries.filter((_, i) => i !== deleteTarget.index);
              setGratitudeData({
                  ...gratitudeData,
                  [dateKey]: newEntries
              });
              setDeleteTarget(null);
          };

          const isMaxReached = currentEntries.length >= 100;

          return (
            <div className="flex-1 flex flex-col h-screen relative overflow-hidden bg-transparent">
              {particles.map(p => (
                <div 
                  key={p.id}
                  style={{
                    position: 'fixed', left: p.x, top: p.y,
                    transform: `translate(-50%, -50%) rotate(${p.rotation}deg) scale(${p.scale})`,
                    color: p.color, fontSize: `${p.fontSize}px`, fontWeight: 'bold',
                    opacity: p.opacity, pointerEvents: 'none', zIndex: 100,
                    textShadow: '0 2px 4px rgba(255,255,255,0.8), 0 0 10px rgba(255,255,255,0.5)', // è¦–èªæ€§ã‚’ä¸Šã’ã‚‹ãŸã‚ã«ç™½ã„å…‰å½©ã‚’ã¤ã‘ã‚‹
                    whiteSpace: 'nowrap'
                  }}
                >
                  {p.char}
                </div>
              ))}

              <header className="bg-white border-b p-4 flex items-center justify-between sticky top-0 z-20 shadow-sm">
                <div className="flex items-center gap-2">
                    <span className="text-2xl">ğŸ“…</span>
                    <div>
                        <h2 className="font-bold text-lg leading-tight">{date.getMonth() + 1}æœˆ{date.getDate()}æ—¥ã®æ„Ÿè¬</h2>
                        <p className="text-xs text-gray-500">ç¾åœ¨: {currentEntries.length}å€‹ / ç›®æ¨™: 30å€‹</p>
                    </div>
                </div>
                <div className="bg-orange-100 text-orange-600 px-3 py-1 rounded-full font-bold text-sm">
                    ã‚ã¨ {Math.max(0, 30 - currentEntries.length)}
                </div>
              </header>

              <div className="flex-1 overflow-y-auto p-4 space-y-4 pb-32">
                {currentEntries.length === 0 && (
                  <div className="text-center py-10 text-gray-400">
                    <p>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br/>ä»Šæ—¥ã®ã€Œã‚ã‚ŠãŒã¨ã†ã€ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ï¼</p>
                  </div>
                )}
                
                {currentEntries.map((entry, index) => {
                  const text = typeof entry === 'string' ? entry : entry.text;
                  const time = typeof entry === 'object' ? entry.time : null;
                  const image = typeof entry === 'object' ? entry.image : null;
                  
                  return (
                    <div 
                        key={index} 
                        className={`flex gap-3 items-start animate-fade-in-up transition-transform duration-200 ${pressingIndex === index ? 'scale-95 opacity-80' : ''}`}
                        onTouchStart={() => startPress(index, entry)}
                        onTouchEnd={cancelPress}
                        onMouseDown={() => startPress(index, entry)}
                        onMouseUp={cancelPress}
                        onMouseLeave={cancelPress}
                        style={{ cursor: 'pointer' }}
                    >
                      <div className="flex-shrink-0 w-8 h-8 rounded-full bg-orange-200 text-orange-700 flex items-center justify-center font-bold text-sm mt-1 select-none shadow-sm border border-orange-100 bg-white">
                        {index + 1}
                      </div>
                      <div className="bg-white p-3 rounded-r-xl rounded-bl-xl shadow-sm text-gray-700 break-words max-w-[85%] relative group select-none w-full border border-gray-100">
                        {image && (
                            <div className="mb-2 relative">
                                <img 
                                    src={image} 
                                    alt="æ·»ä»˜ç”»åƒ" 
                                    className="rounded-lg max-h-48 object-cover border border-gray-100" 
                                    onClick={(e) => { e.stopPropagation(); setZoomedImage(image); }}
                                />
                                <div className="absolute bottom-1 right-1 bg-black bg-opacity-50 p-1 rounded-full text-white">
                                    <ZoomIn size={12} />
                                </div>
                            </div>
                        )}
                        <div>{text}</div>
                        <div className="flex justify-between items-end mt-1">
                             <button 
                                onClick={(e) => {
                                  e.stopPropagation();
                                  setTargetIndexForImage(index);
                                  fileInputRef.current?.click();
                                }}
                                className="text-gray-300 hover:text-orange-500 p-1 transition-colors"
                             >
                                <Camera size={16} />
                             </button>

                             {time && (
                               <div className="text-[10px] text-gray-400 text-right flex items-center gap-1">
                                 <Clock size={10} />
                                 {time}
                               </div>
                             )}
                        </div>
                      </div>
                    </div>
                  );
                })}
                <div ref={scrollRef}></div>
              </div>

              {/* å…¥åŠ›ã‚¨ãƒªã‚¢ */}
              <div className="bg-white p-3 border-t sticky bottom-0 z-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                {/* ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */}
                {attachedImage && (
                    <div className="flex items-center gap-2 mb-2 p-2 bg-gray-50 rounded-lg border border-dashed border-gray-300 mx-1">
                        <img src={attachedImage} alt="Preview" className="h-12 w-12 object-cover rounded" />
                        <span className="text-xs text-gray-500 flex-1">å†™çœŸã‚’æ·»ä»˜ä¸­...</span>
                        <button onClick={() => setAttachedImage(null)} className="p-1 bg-gray-200 rounded-full text-gray-600">
                            <X size={16} />
                        </button>
                    </div>
                )}

                {!isMaxReached ? (
                  <form onSubmit={handleAdd} className="flex flex-col gap-2">
                    <div className="flex gap-2 items-end">
                        <button 
                            type="button"
                            onClick={() => {
                                setTargetIndexForImage(null); // æ–°è¦ç”¨
                                fileInputRef.current?.click();
                            }}
                            className="p-3 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 flex-shrink-0"
                        >
                            <Camera size={24} />
                        </button>
                        <input 
                            type="file" 
                            accept="image/*" 
                            ref={fileInputRef}
                            onChange={handleImageSelect}
                            className="hidden" 
                        />

                        <input
                          type="text"
                          value={inputText}
                          onChange={(e) => setInputText(e.target.value)}
                          placeholder="æ„Ÿè¬ã®è¨€è‘‰ã‚’å…¥åŠ›..."
                          className="flex-1 border-2 border-orange-200 rounded-lg px-4 py-3 focus:outline-none focus:border-orange-400 text-lg"
                        />
                        <button 
                            type="submit" 
                            disabled={!inputText.trim() && !attachedImage}
                            className="bg-orange-500 disabled:bg-gray-300 text-white font-bold px-4 py-3 rounded-lg shadow-md active:scale-95 transition whitespace-nowrap"
                        >
                          æ„Ÿè¬
                        </button>
                    </div>
                  </form>
                ) : (
                  <div className="text-center p-4 bg-green-100 text-green-700 rounded-lg font-bold">ğŸ‰ 100å€‹é”æˆï¼ç´ æ™´ã‚‰ã—ã„1æ—¥ã§ã™ï¼ ğŸ‰</div>
                )}
                <button onClick={onBack} className="w-full mt-2 py-2 text-sm text-gray-500 font-bold hover:bg-gray-100 rounded-lg transition">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹</button>
              </div>
              
              {/* å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« */}
              {deleteTarget && (
                  <div className="absolute inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 p-4">
                      <div className="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm animate-fade-in-up">
                          <h3 className="text-lg font-bold text-gray-800 mb-2 flex items-center gap-2">
                              <Trash2 className="text-red-500" /> å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ
                          </h3>
                          <div className="bg-gray-100 p-3 rounded-lg text-gray-600 mb-6 italic text-sm">
                              "{deleteTarget.text}"
                          </div>
                          <div className="flex gap-3">
                              <button onClick={() => setDeleteTarget(null)} className="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                              <button onClick={executeDelete} className="flex-1 py-3 bg-red-500 text-white rounded-lg font-bold shadow-md">å‰Šé™¤ã™ã‚‹</button>
                          </div>
                      </div>
                  </div>
              )}

              {/* ç”»åƒæ‹¡å¤§ãƒ¢ãƒ¼ãƒ€ãƒ« */}
              {zoomedImage && (
                  <div 
                    className="absolute inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-90 p-2"
                    onClick={() => setZoomedImage(null)}
                  >
                      <img src={zoomedImage} className="max-w-full max-h-full rounded-lg shadow-2xl" alt="Zoomed" />
                      <button className="absolute top-4 right-4 text-white p-2 bg-gray-800 bg-opacity-50 rounded-full">
                        <X size={24} />
                      </button>
                  </div>
              )}
            </div>
          );
        };

        const SettingsScreen = ({ gratitudeData, setGratitudeData, settings, setSettings, onBack }) => {
          const fileInputRef = useRef(null);
          const bgInputRef = useRef(null);

          const handleExport = () => {
            let csvContent = "\uFEFFDate,Time,Text,ImageAttached\n";
            Object.keys(gratitudeData).sort().forEach(date => {
              const entries = gratitudeData[date];
              entries.forEach(entry => {
                const text = typeof entry === 'string' ? entry : entry.text;
                const time = (typeof entry === 'object' && entry.time) ? entry.time : '';
                const hasImage = (typeof entry === 'object' && entry.image) ? 'Yes' : 'No';
                const escapedText = `"${text.replace(/"/g, '""')}"`;
                csvContent += `${date},${time},${escapedText},${hasImage}\n`;
              });
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `gratitude_backup_${new Date().toISOString().slice(0, 10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          };

          const handleImportClick = () => {
            fileInputRef.current?.click();
          };

          const handleFileChange = (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const text = event.target.result;
                const lines = text.split(/\r\n|\n/);
                const newData = { ...gratitudeData };
                let count = 0;

                for (let i = 1; i < lines.length; i++) {
                  const line = lines[i];
                  if (!line.trim()) continue;

                  const parseCSVLine = (str) => {
                    const arr = [];
                    let quote = false;
                    let col = '';
                    for (let c of str) {
                      if (c === '"') { quote = !quote; continue; }
                      if (c === ',' && !quote) { arr.push(col); col = ''; continue; }
                      col += c;
                    }
                    arr.push(col);
                    return arr;
                  };

                  const cols = parseCSVLine(line);
                  if (cols.length < 3) continue;

                  const date = cols[0].trim();
                  const time = cols[1].trim();
                  let content = cols[2];

                  if (!date || !content) continue;

                  if (!newData[date]) newData[date] = [];
                  
                  const exists = newData[date].some(e => {
                    const eText = typeof e === 'string' ? e : e.text;
                    const eTime = (typeof e === 'object' && e.time) ? e.time : '';
                    return eText === content && eTime === time;
                  });

                  if (!exists) {
                    newData[date].push({ text: content, time: time });
                    count++;
                  }
                }

                if (count > 0) {
                  if (confirm(`${count}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒãƒ»è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ\n(ç”»åƒãƒ‡ãƒ¼ã‚¿ã¯CSVã«å«ã¾ã‚Œã¦ã„ãªã„ãŸã‚å¾©å…ƒã•ã‚Œã¾ã›ã‚“)`)) {
                    setGratitudeData(newData);
                    alert("å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸï¼");
                  }
                } else {
                    alert("æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
                }

              } catch (err) {
                console.error(err);
                alert("ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
              }
              e.target.value = '';
            };
            reader.readAsText(file);
          };

          const handleBgChange = async (e) => {
              const file = e.target.files[0];
              if(!file) return;
              try {
                  const dataUrl = await compressImage(file);
                  setSettings({ ...settings, backgroundImage: dataUrl });
                  alert("èƒŒæ™¯ç”»åƒã‚’è¨­å®šã—ã¾ã—ãŸï¼");
              } catch(e) {
                  alert("ç”»åƒã®è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ");
              }
          };

          const clearBg = () => {
              setSettings({ ...settings, backgroundImage: null });
              alert("èƒŒæ™¯ç”»åƒã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
          };

          return (
            <div className="flex-1 flex flex-col bg-slate-50 h-screen overflow-y-auto">
              <header className="bg-white border-b p-4 flex items-center shadow-sm sticky top-0 z-20">
                <button onClick={onBack} className="p-2 hover:bg-gray-100 rounded-full mr-2">
                    <ArrowLeft className="text-gray-600" />
                </button>
                <h2 className="text-xl font-bold text-gray-800">è¨­å®šãƒ»ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
              </header>

              <div className="p-6 space-y-6">
                
                {/* èƒŒæ™¯è¨­å®š */}
                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <div className="flex items-center gap-3 mb-4 text-pink-500">
                        <ImageIcon size={28} />
                        <h3 className="text-lg font-bold">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®èƒŒæ™¯</h3>
                    </div>
                    <p className="text-gray-600 mb-6 text-sm">
                        ãŠæ°—ã«å…¥ã‚Šã®ç”»åƒã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®èƒŒæ™¯ã«è¨­å®šã§ãã¾ã™ã€‚<br/>
                        ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®å£ç´™ã®ã‚ˆã†ã«ã€1æšã®ç”»åƒãŒå¤§ããè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                    </p>
                    <div className="flex gap-2">
                        <button 
                            onClick={() => bgInputRef.current?.click()}
                            className="flex-1 bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 shadow-md transition active:scale-95"
                        >
                            <ImageIcon size={20} />
                            ç”»åƒã‚’è¨­å®š
                        </button>
                        {settings.backgroundImage && (
                            <button 
                                onClick={clearBg}
                                className="bg-gray-200 text-gray-600 font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 shadow-sm"
                            >
                                <Trash2 size={20} />
                            </button>
                        )}
                    </div>
                    <input 
                        type="file" 
                        accept="image/*"
                        ref={bgInputRef}
                        onChange={handleBgChange}
                        className="hidden"
                    />
                </div>

                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <div className="flex items-center gap-3 mb-4 text-orange-600">
                        <FileText size={28} />
                        <h3 className="text-lg font-bold">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— (ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ)</h3>
                    </div>
                    <p className="text-gray-600 mb-6 text-sm">
                        ã“ã‚Œã¾ã§ã®æ„Ÿè¬ã®è¨˜éŒ²ã‚’ã€CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ç«¯æœ«ã«ä¿å­˜ã—ã¾ã™ã€‚<br/>
                        <span className="text-red-500 font-bold">â€»æ³¨æ„: å†™çœŸãƒ‡ãƒ¼ã‚¿ã¯å®¹é‡ãŒå¤§ãã„ãŸã‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«å«ã¾ã‚Œã¾ã›ã‚“ã€‚</span>
                    </p>
                    <button 
                        onClick={handleExport}
                        className="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 shadow-md transition active:scale-95"
                    >
                        <Download size={20} />
                        CSVãƒ•ã‚¡ã‚¤ãƒ«ã§ä¿å­˜ã™ã‚‹
                    </button>
                </div>

                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <div className="flex items-center gap-3 mb-4 text-blue-600">
                        <Upload size={28} />
                        <h3 className="text-lg font-bold">å¾©å…ƒ (ã‚¤ãƒ³ãƒãƒ¼ãƒˆ)</h3>
                    </div>
                    <p className="text-gray-600 mb-6 text-sm">
                        ä¿å­˜ã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™ã€‚<br/>
                        ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚
                    </p>
                    <button 
                        onClick={handleImportClick}
                        className="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 shadow-md transition active:scale-95"
                    >
                        <Upload size={20} />
                        CSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¾©å…ƒã™ã‚‹
                    </button>
                    <input 
                        type="file" 
                        accept=".csv"
                        ref={fileInputRef}
                        onChange={handleFileChange}
                        className="hidden"
                    />
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>